

CL_BIN_PATH=${CL_PREFIX%/}/${CL_BIN_PATH%/}
CL_LIB_PATH=${CL_PREFIX%/}/${CL_LIB_PATH%/}
CL_CONF_PATH=${CL_PREFIX%/}/${CL_CONF_PATH%/}
CL_LOG_PATH=${CL_PREFIX%/}/${CL_LOG_PATH%/}
CL_INC_PATH=${CL_PREFIX%/}/${CL_INC_PATH%/}


# append install target

cat << END >> $CL_MAKEFILE

#---------------------------------------


install: build $CL_BIN_PATH $CL_LIB_PATH $CL_CONF_PATH $CL_INC_PATH
	\$(call if-cp, $CL_OBJS/bin, $CL_BIN_PATH/)
	\$(call if-cp, $CL_OBJS/lib, $CL_LIB_PATH/)
	\$(call if-cp, $CL_OBJS/conf, $CL_CONF_PATH/)
	\$(call if-cp, $CL_OBJS/inc, $CL_INC_PATH/)


$CL_BIN_PATH $CL_LIB_PATH $CL_CONF_PATH $CL_INC_PATH:
	\$(call if-mkdir, $CL_BIN_PATH)
	\$(call if-mkdir, $CL_LIB_PATH)
	\$(call if-mkdir, $CL_CONF_PATH)
	\$(call if-mkdir, $CL_INC_PATH)
	\$(call if-mkdir, $CL_LOG_PATH)


if-mkdir = \$(if \$(wildcard \$1),,mkdir -p \$1)
if-cp = \$(foreach f,\$(wildcard \$1/*),\$(shell cp \$(f) \$2))



END



# create Makefile

cat << END >> Makefile

build:
	\$(MAKE) -f $CL_MAKEFILE

install: 
	\$(MAKE) -f $CL_MAKEFILE install

END


